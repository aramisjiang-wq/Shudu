# 会话记录 & 复用原则

> Last updated: 2025-11-26T13:30:00Z  
> 内容：梳理本次合作的全部对话要点，提炼可复用的工作原则 & 提示词，供未来 AI Coding Agent 参考。

## 1. 会话时间线
| 序号 | 时间 (UTC) | 角色 | 摘要 |
| --- | --- | --- | --- |
| 1 | 2025-11-26T06:30 | 用户 | 设定 6 条工作规则：文档即真相、系统秩序优先、问题驱动、最小化复杂度、显式沟通、上下文完整性。 |
| 2 | 06:31 | 用户 | 提出需求：构建带登录/战绩的网页版数独。 |
| 3 | 06:32 | 助手 | 审阅现有 repo，完成 README/Architecture 初始版本。 |
| 4 | 06:40 | 助手 | 尝试 `npm install`，因沙箱权限失败。 |
| 5 | 06:45 | 助手 | 修复 `App` 中 `useCallback` 依赖问题；微调 server 错误处理中类型导入。 |
| 6 | 06:50 | 用户 | 询问游戏是否可运行。 |
| 7 | 06:51 | 助手 | 解释依赖安装失败原因（`better-sqlite3` 下载 headers 需证书）。 |
| 8 | 06:53 | 用户 | 要求直接处理。 |
| 9 | 06:54-06:58 | 助手 | 申请系统权限，多次 `npm install`（处理 TLS、Node 版本、`better-sqlite3` 编译）。 |
| 10 | 06:58 | 助手 | 安装 `nvm`，切换 Node 20，依赖安装成功。 |
| 11 | 07:00 | 助手 | 启动 `npm run dev`，修复 server dev 脚本（改用 `tsx watch`），添加 `web/index.html` → Vite 200 OK。 |
| 12 | 07:05 | 用户 | 反馈成功登录，但需要更符合数独规范的交互。 |
| 13 | 07:06-07:20 | 助手 | 文档先行 → 更新 Architecture/README；实现草稿模式、高亮、数字余量及 UI 优化；通过 `npm run lint -w web`。 |
| 14 | 07:25 | 用户 | 确认可行，要求整理 PRD、Spec、项目总结、会话记录 & 可复用原则/提示词。 |
| 15 | 07:26-07:35 | 助手 | 创建 `docs/prd.md`, `docs/spec.md`, `docs/project-summary.md`, `docs/conversation-log.md`（本文）。 |

## 2. 核心结论
1. **文档驱动**：任何实现前必须同步 PRD/Spec/Architecture；时间戳追踪每次调整。
2. **前后端职责**：前端保持纯 UI/状态；后端提供稳定 API/SQLite 持久化。
3. **交互标准**：同行列/宫高亮、同值联动、草稿模式、数字余量提示、快捷键，这是“符合数独规范”的最低门槛。
4. **环境依赖**：Node LTS (20.x) + `nvm` + TLS 配置是安装成功关键。
5. **显式沟通**：所有风险（证书、编译、脚本）在回答中需说明原因与解决方案。

## 3. 复用原则（结合用户原始 6 条）
| 原始原则 | 扩展解释 / 本次实践 |
| --- | --- |
| 文档即真相 | 每次修改 README/Architecture/PRD/Spec 的 `Last updated`，并在代码前完成文档。 |
| 系统秩序优先 | 目录清晰（docs/server/web）；脚本 `npm run dev` 统一前后端；敏感配置放 `.env`。 |
| 问题驱动迭代 | 明确“依赖安装失败”“交互不符合”等问题，提供根因 + 方案 + 预防。 |
| 最小化复杂度 | 单一技术栈 TS/Node；`SudokuBoard` 通过 props 配置而非全局状态；避免过度抽象。 |
| 显式沟通 | 遇到权限/TLS/编译问题即刻说明，并提出可选方案。 |
| 上下文完整性 | 每次回复提及当前时间/状态（如 dev server 是否运行），并记录在文档/总结中。 |

## 4. 提示词模板（供后续 AI Coding 复用）
```
你是一名遵循“文档即真相、系统秩序优先、问题驱动、最小化复杂度、显式沟通、上下文完整性”六原则的工程助手。处理新需求时：
1. 先阅读 README、docs/prd.md、docs/spec.md、docs/architecture.md，确保理解最新事实。
2. 若需修改代码，先更新相关文档并写明 Last updated。
3. 任何命令前确保使用 Node 20 (`nvm use 20`)，如需联网/权限说明理由。
4. 变更 `web/src` 时保持 SudokuBoard 作为唯一棋盘渲染层，交互通过 props 控制。
5. 结果汇报包含：问题、解决方案、受影响文件、验证步骤、风险。
6. 若发现环境/依赖问题，立刻描述根因和可行替代方案。
```

## 5. 历史对话（摘要版）
1. 规则确认 → 需求 (数独 + 登录) → 建立文档。
2. 安装阶段 → 沙箱/TLS/Node/`better-sqlite3` 问题 → 通过 `nvm` + Node20 解决。
3. Dev server 更新 → Vite/root HTML 修复。
4. UX 优化（草稿、高亮、按钮、UI）。
5. 文档体系扩充（PRD/Spec/Summary/Conversation Log）。

完整细节可参照上方时间线及其它文档（Spec/PRD）中的描述。




